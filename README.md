# Blocky Valentine Survival

Browser-based real-time 3D game with Minecraft-inspired visuals.

- Frontend: Three.js (`/client`)
- Backend: Node.js + WebSockets (`/server`) for multiplayer only
- Modes:
  - Single Player (offline, no WebSocket/server required)
  - Multiplayer LAN (2 players, shared authoritative world)

## Zombie FBX Setup
This project uses two FBX files for zombies:

- Walking animation: `client/assets/zombie-walk.fbx`
- Attack animation: `client/assets/zombie-attack.fbx`

Expected source files used:
- `/Users/vikas/Downloads/Scary Clown Start Walking.fbx` -> `client/assets/zombie-walk.fbx`
- `/Users/vikas/Downloads/Zombie Attack.fbx` -> `client/assets/zombie-attack.fbx`

The client loads both at startup with `FBXLoader`, auto-scales model height to target zombie height (~1.95 world units), and reuses shared model data with per-instance animation mixers.

## Girl Character FBX + Combo
The GIRL player now uses FBX animations:
- `client/assets/girl-idle.fbx`
- `client/assets/girl-walk.fbx`
- `client/assets/girl-run.fbx`
- `client/assets/girl-punch.fbx`
- `client/assets/girl-kick.fbx`

Behavior:
- Idle / Walk / Run state blending while moving
- Space attack combo: Punch -> Kick chain
- Second Space press within combo window chains kick
- Hit windows:
  - Punch: 35% to 55%
  - Kick: 30% to 60%
- Attack range ~1.6 with front arc and cooldown after combo
- Hold `Space` for continuous chained combat (Punch -> Kick loop) with queued attacks.

## Boy Character FBX + Continuous Separate Attacks
BOY now uses FBX animations:
- `client/assets/boy-fist.fbx`
- `client/assets/boy-kick.fbx`
- `client/assets/boy-jump.fbx`
- `client/assets/boy-dance.fbx`

Controls for BOY:
- `J`: fist attack (hold to repeat)
- `K`: kick attack (hold to repeat)
- `L`: jump attack (hold to repeat)

Behavior:
- Idle / Walk / Run blended states on the FBX model
- Separate hold-to-repeat attacks (no auto-combo)
- If multiple attack keys are held, latest pressed key is prioritized
- Hit windows:
  - Fist: 35% to 55%
  - Kick: 30% to 60%
  - Jump: 40% to 70%
- Attack range/arc tuned for BOY and zombies get knockback + hit burst feedback
- BOY plays Macarena dance briefly when zombie alive count reaches 0

## Smooth Simulation
- Client and server gameplay simulation use a fixed timestep (60 Hz) with delta clamping.
- Multiplayer snapshots are sent at ~20 Hz and clients interpolate transforms for smoother motion.
- A small debug overlay shows FPS, render delta, and simulation steps per second.

## Modes

### Single Player
- No rooms and no server required
- Select Boy or Girl, then start immediately
- Objective: survive and kill zombies
- HUD:
  - Timer
  - HP
  - Zombies killed
  - Current zombies alive
  - Difficulty level
- Zombie AI uses state machine (`IDLE`, `CHASE`, `ATTACK`, `STUN`)
- Attack windows and cooldowns are tied to animation timing
- On death: Game Over overlay with survival time + kills + restart

### Multiplayer (LAN Wi-Fi)
- Exactly 2 players per room
- Server authoritative:
  - Zombie positions, FSM state, target selection, attack timing
  - Player HP/heart/objective state
- Client interpolates zombie motion and plays animation states
- Server sends attack events (`attackStart`, hit events) for synced feedback
- Full valentine quest remains:
  - Hearts objective (20 letters)
  - Sentence reveal for both players
  - Minimap + teammate distance
  - Proposal YES/NO when both have 20 hearts and are within 3m

## Endless Terrain
- Client now uses chunk streaming (`ChunkManager`) to generate an endless-looking world around the player.
- Chunks are generated/unloaded by distance to keep performance stable.
- Terrain is deterministic from seed with:
  - Grass lowlands and hills
  - Mountains with snow caps
  - Lakes/water level + sand beaches
  - Trees, rock clusters, grass details, sparse flowers
- Multiplayer seed is generated by server per room and sent to both clients so both see the same terrain.

Key config constants in `/client/game.js`:
- `CHUNK_SIZE`
- `VIEW_DISTANCE`
- `WATER_LEVEL`
- `SNOW_LINE`
- `SEED`

## Controls
- Arrow keys: move
- Mouse: rotate camera (click game canvas for pointer lock)
- Shift: sprint
- Space: attack

## UI Flow
- Start Menu -> Mode Select -> Single Player or Multiplayer
- Back buttons between Start/Mode/Multiplayer menus

## Project Structure
- `/client`: UI + Three.js rendering + FBX zombies + single-player simulation + multiplayer client
- `/server`: authoritative room/game state + zombie FSM + LAN WebSocket server

## Run Single Player (Client Only)
Option A:
```bash
python3 -m http.server 5173 --directory client
```
Open:
- `http://localhost:5173`

Option B:
- Serve `/client` with any static server.

## Run Multiplayer (LAN)
1. Install dependencies:
```bash
npm install
```
2. Start server:
```bash
npm run dev
```
3. Server binds `0.0.0.0` and prints LAN URLs.
4. Host opens LAN URL, picks character, enters Multiplayer, creates room.
5. Guest opens same LAN URL on same Wi-Fi, joins with room code.

## LAN Notes
- No cloud deployment required
- Client uses `window.location.hostname` for WebSocket host
- Share host URL: `http://<HOST_LAN_IP>:3000`
